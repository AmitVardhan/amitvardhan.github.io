<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pre Shot Routine</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&display=swap" rel="stylesheet">

<style>
/* ================= BASE ================= */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden; /* prevent scroll */
}

body {
  background: radial-gradient(circle at center, #1e3d3d 0%, #000 70%);
  font-family: 'Orbitron', monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #fff;
  text-align: center;
}

/* ================= CUE DISPLAY ================= */
#cue {
  font-size: clamp(18px, 4vw, 48px);
  margin-bottom: 1vh;
  min-height: 3ch;
  word-wrap: break-word;
  max-width: 95vw;
}

/* ================= TIMER DISPLAY ================= */
#timer {
  font-size: clamp(80px, 20vw, 250px);
  font-weight: 700;
  padding: 2vw;
  border-radius: 1.5vw;
  background: rgba(30,60,60,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  max-width: 95vw;
  max-height: 80vh;
  box-shadow:
    inset 0 0 0 0.3vw rgba(255,255,255,0.05),
    0 2vh 5vh rgba(0,0,0,0.9);
  transition: color 0.25s ease, text-shadow 0.25s ease;
  word-break: break-word;
}

.led-digit { display: inline-block; position: relative; }
.led-digit::after {
  content: attr(data-digit);
  position: absolute;
  inset: 0;
  opacity: 0.1;
  animation: flicker 0.1s infinite alternate;
}
@keyframes flicker { 0% { opacity: 0.08; } 100% { opacity: 0.15; } }

.timer-green { color: #9fffe0; text-shadow: 0 0 2vw #9fffe0; }
.timer-yellow { color: #ffe29a; text-shadow: 0 0 2vw #ffe29a; }
.timer-red { color: #ff6b6b; text-shadow: 0 0 2vw #ff6b6b; }

.pulse { animation: pulse 1s infinite; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

/* ================= AUTOPLAY BUTTON ================= */
#autoBtn {
  margin-top: 2vh;
  font-family: inherit;
  font-size: clamp(16px, 4vw, 22px);
  padding: 1vh 2vw;
  color: #9fffe0;
  background: rgba(0,0,0,0.4);
  border: 0.2vw solid #9fffe0;
  border-radius: 0.5vw;
  cursor: pointer;
  transition: all 0.25s ease;
}

#autoBtn.active {
  background: #ff6b6b;
  border-color: #ff6b6b;
  color: #000;
  box-shadow: 0 0 2vw #ff6b6b;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 600px) {
  #timer { font-size: clamp(60px, 25vw, 180px); padding: 1.5vw; border-radius: 2vw; }
  #cue { font-size: clamp(14px, 4vw, 32px); }
  #autoBtn { font-size: clamp(14px, 5vw, 18px); padding: 1vh 2vw; }
}

@media (max-height: 500px) {
  #timer { max-height: 70vh; font-size: clamp(50px, 20vw, 140px); }
  #cue { font-size: clamp(12px, 4vw, 28px); }
}
</style>
</head>

<body>

<div id="cue">Find Contact Point</div>
<div id="timer" class="timer-green">30</div>
<button id="autoBtn">AutoPlay</button>

<audio id="beep10" src="assets/audio/beep10.wav" preload="auto"></audio>
<audio id="beep5" src="assets/audio/beep5.wav" preload="auto"></audio>
<audio id="beep0" src="assets/audio/beep0.wav" preload="auto"></audio>

<script>
// JSON Preset for Preshot Routine
const PRESHOT_CUES = [
  { "start": 30, "end": 28, "message": "Find Contact Point" },
  { "start": 27, "end": 25, "message": "Decide Line of Aim" },
  { "start": 24, "end": 15, "message": "Decision (Visualize, Speed, Shape, Chalk)" },
  { "start": 14, "end": 10, "message": "Setup" },
  { "start": 9, "end": 0, "message": "Execute" }
];

const SHOT_TIME = 30;
let endTime = null;
let rafId = null;
let running = false;
let lastSecondPlayed = null;
let autoPlay = false;

const timerEl = document.getElementById("timer");
const cueEl = document.getElementById("cue");
const autoBtn = document.getElementById("autoBtn");
const beep10 = document.getElementById("beep10");
const beep5 = document.getElementById("beep5");
const beep0 = document.getElementById("beep0");

function getCue(seconds) {
  const cue = PRESHOT_CUES.find(c => seconds <= c.start && seconds >= c.end);
  return cue ? cue.message : "";
}

function startShot() {
  lastSecondPlayed = null;
  endTime = Date.now() + SHOT_TIME * 1000;
  running = true;
  tick();
}

function stopShot() {
  running = false;
  cancelAnimationFrame(rafId);
}

function tick() {
  if (!running) return;

  const remainingMs = endTime - Date.now();
  const seconds = Math.max(0, Math.ceil(remainingMs / 1000));

  timerEl.innerHTML = seconds.toString().split("").map(d => `<span class="led-digit" data-digit="${d}">${d}</span>`).join("");
  timerEl.className = "";
  if (seconds === 0) timerEl.classList.add("timer-red");
  else if (seconds <= 5) timerEl.classList.add("timer-yellow", "pulse");
  else timerEl.classList.add("timer-green");

  cueEl.textContent = getCue(seconds);

  if (seconds === 10 && lastSecondPlayed !== 10) { beep10.currentTime = 0; beep10.play(); lastSecondPlayed = 10; }
  if (seconds <= 5 && seconds > 0 && lastSecondPlayed !== seconds) { beep5.currentTime = 0; beep5.play(); lastSecondPlayed = seconds; }
  if (seconds === 0 && lastSecondPlayed !== 0) {
    beep0.currentTime = 0; beep0.play();
    lastSecondPlayed = 0;
    running = false;
    if (autoPlay) setTimeout(startShot, 600);
    return;
  }

  rafId = requestAnimationFrame(tick);
}

autoBtn.onclick = () => {
  autoPlay = !autoPlay;
  autoBtn.classList.toggle("active", autoPlay);
  autoBtn.textContent = autoPlay ? "Stop" : "AutoPlay";
  if (autoPlay && !running) startShot();
};
</script>

</body>
</html>