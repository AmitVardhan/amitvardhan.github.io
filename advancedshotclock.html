<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Professional Shot Clock</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&display=swap" rel="stylesheet">

<style>
/* ================= THEMES ================= */
body.theme-matchroom {
  --bg-main: radial-gradient(circle at center, #111 0%, #000 65%);
  --panel-bg: rgba(0,0,0,0.45);
  --green: #00e676;
  --yellow: #ffd54f;
  --red: #ff5252;
}
body.theme-led {
  --bg-main: radial-gradient(circle at center, #050505 0%, #000 70%);
  --panel-bg: rgba(0,0,0,0.55);
  --green: #00ff00;
  --yellow: #ffff00;
  --red: #ff0000;
}
body.theme-calm {
  --bg-main: #2b2b3a;
  --panel-bg: rgba(50,50,60,0.4);
  --green: #8fd3f4;
  --yellow: #ffd59e;
  --red: #ff6f61;
}
body.theme-teal {
  --bg-main: #1e3d3d;
  --panel-bg: rgba(30,60,60,0.4);
  --green: #9fffe0;
  --yellow: #ffe29a;
  --red: #ff6b6b;
}

/* ================= BASE ================= */
* { box-sizing: border-box; user-select: none; }

body {
  margin: 0;
  min-height: 100vh;
  background: var(--bg-main);
  font-family: 'Orbitron', monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

/* ================= TIMER ================= */
#timer {
  font-size: clamp(120px, 30vw, 320px);
  font-weight: 700;
  padding: 30px 60px;
  border-radius: 16px;
  background: var(--panel-bg);
  text-align: center;
  min-width: 8ch;
  box-shadow:
    inset 0 0 0 2px rgba(255,255,255,0.05),
    0 25px 60px rgba(0,0,0,0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  transition: color 0.25s ease, text-shadow 0.25s ease;
}

.led-digit {
  display: inline-block;
  position: relative;
}
.led-digit::after {
  content: attr(data-digit);
  position: absolute;
  inset: 0;
  opacity: 0.1;
  animation: flicker 0.1s infinite alternate;
}
@keyframes flicker {
  0% { opacity: 0.08; }
  100% { opacity: 0.15; }
}

.timer-green { color: var(--green); text-shadow: 0 0 25px var(--green); }
.timer-yellow { color: var(--yellow); text-shadow: 0 0 25px var(--yellow); }
.timer-red { color: var(--red); text-shadow: 0 0 30px var(--red); }

.pulse { animation: pulse 1s infinite; }
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.04); }
  100% { transform: scale(1); }
}

/* ================= CONTROLS ================= */
#controls {
  margin-top: 30px;
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  justify-content: center;
  border-top: 1px solid rgba(255,255,255,0.08);
  padding-top: 20px;
}

button, select {
  font-family: inherit;
  font-size: 18px;
  padding: 10px 22px;
  color: var(--green);
  background: linear-gradient(to bottom, rgba(255,255,255,0.08), rgba(0,0,0,0.4));
  border: 2px solid var(--green);
  border-radius: 6px;
  cursor: pointer;
}

button:hover, select:hover {
  background: var(--green);
  color: #000;
}

#autoBtn.active {
  background: var(--red);
  border-color: var(--red);
  color: #000;
  box-shadow: 0 0 25px var(--red);
}

/* ================= FOOTER ================= */
footer {
  margin-top: auto;
  padding: 12px 0;
  font-size: 14px;
  color: #aaa;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 600px) {
  #timer {
    font-size: clamp(80px, 25vw, 200px);
    padding: 20px 40px;
  }
  button, select {
    font-size: 16px;
    padding: 8px 18px;
  }
}
</style>
</head>

<body class="theme-teal">

<div id="timer" class="timer-green">30</div>

<div id="controls">
  <button id="startBtn">Start Shot</button>
  <button id="stopBtn">Stop</button>
  <button id="extendBtn">Extension</button>
  <button id="autoBtn">AutoPlay</button>

  <select id="presetSelect">
    <option value="matchroom">Matchroom</option>
    <option value="matchroom-fast">Matchroom Fast</option>
    <option value="practice">Practice</option>
  </select>

  <select id="themeSelect">
    <option value="theme-led">LED</option>
    <option value="theme-matchroom">Matchroom Pro</option>
    <option value="theme-calm">Calm Blue</option>
    <option value="theme-teal" selected>Relaxed Teal</option>
  </select>
</div>

<audio id="beep10" src="assets/audio/beep10.wav" preload="auto"></audio>
<audio id="beep5" src="assets/audio/beep5.wav" preload="auto"></audio>
<audio id="beep0" src="assets/audio/beep0.wav" preload="auto"></audio>

<footer>© 2025 Amit Vardhan. All rights reserved.</footer>

<script>
const PRESETS = {
  matchroom: { shotTime: 30, extensionTime: 30 },
  "matchroom-fast": { shotTime: 25, extensionTime: 25 },
  practice: { shotTime: 60, extensionTime: 0 }
};

let currentPreset = PRESETS.matchroom;
let endTime = null;
let rafId = null;
let running = false;
let extensionUsed = false;
let lastSecondPlayed = null;
let autoPlay = false;

const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const extendBtn = document.getElementById("extendBtn");
const autoBtn = document.getElementById("autoBtn");
const presetSelect = document.getElementById("presetSelect");
const themeSelect = document.getElementById("themeSelect");

const beep10 = document.getElementById("beep10");
const beep5 = document.getElementById("beep5");
const beep0 = document.getElementById("beep0");

function startShot() {
  lastSecondPlayed = null;
  extensionUsed = false;
  extendBtn.disabled = currentPreset.extensionTime === 0;
  endTime = Date.now() + currentPreset.shotTime * 1000;
  running = true;
  tick();
}

function stopShot() {
  running = false;
  cancelAnimationFrame(rafId);
}

function useExtension() {
  if (!running || extensionUsed || currentPreset.extensionTime === 0) return;
  extensionUsed = true;
  endTime += currentPreset.extensionTime * 1000;
  extendBtn.disabled = true;
}

function tick() {
  if (!running) return;

  const remainingMs = endTime - Date.now();
  const seconds = Math.max(0, Math.ceil(remainingMs / 1000)); // ✅ FIX

  timerEl.innerHTML = seconds.toString().split("")
    .map(d => `<span class="led-digit" data-digit="${d}">${d}</span>`).join("");

  timerEl.className = "";
  if (seconds === 0) timerEl.classList.add("timer-red");
  else if (seconds <= 5) timerEl.classList.add("timer-yellow", "pulse");
  else timerEl.classList.add("timer-green");

  if (seconds === 10 && lastSecondPlayed !== 10) {
    beep10.currentTime = 0; beep10.play();
    lastSecondPlayed = 10;
  }
  if (seconds <= 5 && seconds > 0 && lastSecondPlayed !== seconds) {
    beep5.currentTime = 0; beep5.play();
    lastSecondPlayed = seconds;
  }
  if (seconds === 0 && lastSecondPlayed !== 0) {
    beep0.currentTime = 0; beep0.play();
    lastSecondPlayed = 0;
    running = false;
    if (autoPlay) setTimeout(startShot, 600);
    return;
  }

  rafId = requestAnimationFrame(tick);
}

startBtn.onclick = startShot;
stopBtn.onclick = () => { autoPlay = false; autoBtn.textContent = "AutoPlay"; stopShot(); };
extendBtn.onclick = useExtension;

autoBtn.onclick = () => {
  autoPlay = !autoPlay;
  autoBtn.textContent = autoPlay ? "Stop" : "AutoPlay";
  if (autoPlay && !running) startShot();
};

presetSelect.onchange = e => {
  currentPreset = PRESETS[e.target.value];
  stopShot();
  timerEl.textContent = currentPreset.shotTime;
  extendBtn.disabled = currentPreset.extensionTime === 0;
};

themeSelect.onchange = e => document.body.className = e.target.value;

presetSelect.value = "matchroom";
</script>

</body>
</html>
